<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>X Search URL Builder</title>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 24px;
            max-width: 1020px;
        }

        h1 {
            font-size: 20px;
            margin: 0 0 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 14px;
        }

        label {
            display: block;
            font-size: 12px;
            color: #333;
            margin-bottom: 6px;
        }

        input,
        textarea,
        select {
            width: 100%;
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: 14px;
        }

        textarea {
            min-height: 70px;
            resize: vertical;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .row3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        button {
            padding: 10px 12px;
            border: 1px solid #ccc;
            background: #fff;
            border-radius: 10px;
            cursor: pointer;
        }

        button.primary {
            border-color: #111;
        }

        .out {
            margin-top: 12px;
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        }

        .hint {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            line-height: 1.4;
        }

        .subhead {
            font-size: 14px;
            margin: 0 0 10px;
        }

        fieldset {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 10px 12px;
            margin: 12px 0 0;
        }

        legend {
            font-size: 12px;
            color: #333;
            padding: 0 6px;
        }

        .radioRow {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .radio {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .radio input {
            width: auto;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 760px) {
            .row3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <h1>X (Twitter) Search URL Builder</h1>

    <div class="grid">
        <div class="card">
            <h2 class="subhead">Words</h2>

            <label>All of these words</label>
            <input id="allWords" placeholder="cats dogs" />

            <label style="margin-top:10px;">This exact phrase</label>
            <input id="exactPhrase" placeholder="happy hour" />

            <label style="margin-top:10px;">Any of these words (OR)</label>
            <input id="anyWords" placeholder="cats dogs (becomes: cats OR dogs)" />

            <label style="margin-top:10px;">None of these words</label>
            <input id="noneWords" placeholder="spam ads" />

            <label style="margin-top:10px;">These hashtags</label>
            <input id="hashtags" placeholder="#ThrowbackThursday #datascience" />

            <fieldset>
                <legend>Filters</legend>

                <div style="margin-top:2px;font-size:12px;color:#555;">Replies</div>
                <div class="radioRow">
                    <label class="radio">
                        <input type="radio" name="replyFilter" id="replyInclude" value="include" checked>
                        Include replies and original posts
                    </label>
                    <label class="radio">
                        <input type="radio" name="replyFilter" id="replyOnly" value="only">
                        Only show replies
                    </label>
                </div>

                <div style="margin-top:10px;font-size:12px;color:#555;">Links</div>
                <div class="radioRow">
                    <label class="radio">
                        <input type="radio" name="linkFilter" id="linkInclude" value="include" checked>
                        Include posts with links
                    </label>
                    <label class="radio">
                        <input type="radio" name="linkFilter" id="linkOnly" value="only">
                        Only show posts with links
                    </label>
                </div>
            </fieldset>
        </div>

        <div class="card">
            <h2 class="subhead">Accounts + Dates + Engagement</h2>

            <div class="row">
                <div>
                    <label>From these accounts (comma-separated)</label>
                    <input id="fromAccounts" placeholder="parmsam_" />
                </div>
                <div>
                    <label>To these accounts (comma-separated)</label>
                    <input id="toAccounts" placeholder="elonmusk" />
                </div>
            </div>

            <label style="margin-top:10px;">Mentioning these accounts (comma-separated)</label>
            <input id="mentions" placeholder="nytimes, nasa" />

            <div class="row" style="margin-top:10px;">
                <div>
                    <label>Since (YYYY-MM-DD)</label>
                    <input id="since" placeholder="2025-01-01" />
                </div>
                <div>
                    <label>Until (YYYY-MM-DD)</label>
                    <input id="until" placeholder="2025-02-01" />
                </div>
            </div>

            <div class="row" style="margin-top:10px;">
                <div>
                    <label>Tab</label>
                    <select id="tab">
                        <option value="top">Top</option>
                        <option value="live">Latest</option>
                    </select>
                </div>
                <div>
                    <label>Language (optional)</label>
                    <input id="lang" placeholder="en" list="langList" />
                    <datalist id="langList">
                        <option value="en"></option>
                        <option value="es"></option>
                        <option value="fr"></option>
                        <option value="de"></option>
                        <option value="it"></option>
                        <option value="pt"></option>
                        <option value="ja"></option>
                        <option value="ko"></option>
                        <option value="zh"></option>
                        <option value="hi"></option>
                        <option value="gu"></option>
                        <option value="ar"></option>
                        <option value="ru"></option>
                    </datalist>
                </div>
            </div>

            <div class="row3" style="margin-top:10px;">
                <div>
                    <label>Minimum replies</label>
                    <input id="minReplies" type="number" min="0" step="1" placeholder="e.g., 280" />
                </div>
                <div>
                    <label>Minimum likes</label>
                    <input id="minLikes" type="number" min="0" step="1" placeholder="e.g., 280" />
                </div>
                <div>
                    <label>Minimum reposts</label>
                    <input id="minReposts" type="number" min="0" step="1" placeholder="e.g., 280" />
                </div>
            </div>

            <div class="hint">
                URL format: <span
                    class="mono">https://x.com/search?q=...&amp;src=typed_query&amp;f=top|live</span><br />
                Adds operators like <span class="mono">filter:replies</span>, <span class="mono">filter:links</span>,
                <span class="mono">min_replies:</span>, <span class="mono">min_faves:</span>, <span
                    class="mono">min_retweets:</span>.
            </div>
        </div>
    </div>

    <div class="card out">
        <label>Generated query (what goes in q=)</label>
        <textarea id="query" class="mono" readonly></textarea>

        <label style="margin-top:10px;">Generated URL</label>
        <textarea id="url" class="mono" readonly></textarea>

        <div class="btns">
            <button class="primary" id="copyUrl">Copy URL</button>
            <button id="copyQuery">Copy query</button>
            <button id="openX">Open in X</button>
            <button id="reset">Reset</button>
        </div>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);

        function splitList(v) {
            return v.split(",").map(s => s.trim()).filter(Boolean);
        }

        function safeInt(v) {
            if (v === "" || v === null || v === undefined) return null;
            const n = Number(v);
            if (!Number.isFinite(n) || n < 0) return null;
            return Math.floor(n);
        }

        // Wrap multiple items as an OR-group; single item stays unwrapped.
        function orGroup(items, mapper) {
            const mapped = items.map(mapper).filter(Boolean);
            if (mapped.length === 0) return "";
            if (mapped.length === 1) return mapped[0];
            return `(${mapped.join(" OR ")})`;
        }

        function buildQuery() {
            const parts = [];

            // Words
            const allWords = $("allWords").value.trim();
            if (allWords) parts.push(allWords);

            const exact = $("exactPhrase").value.trim();
            if (exact) parts.push(`"${exact.replaceAll('"', '\\"')}"`);

            const any = $("anyWords").value.trim();
            if (any) {
                if (any.toUpperCase().includes(" OR ")) {
                    // If user typed OR themselves, respect it; wrap only if multiple terms are present
                    const needsWrap = /\s+OR\s+/i.test(any.trim());
                    parts.push(needsWrap ? `(${any.trim()})` : any.trim());
                } else {
                    const toks = any.split(/\s+/).filter(Boolean);
                    if (toks.length === 1) parts.push(toks[0]);
                    else if (toks.length > 1) parts.push(`(${toks.join(" OR ")})`);
                }
            }

            const none = $("noneWords").value.trim();
            if (none) {
                none.split(/\s+/).filter(Boolean).forEach(w => parts.push(`-${w}`));
            }

            const hashtags = $("hashtags").value.trim();
            if (hashtags) {
                hashtags.split(/\s+/).filter(Boolean).forEach(h => {
                    const tag = h.startsWith("#") ? h.slice(1) : h;
                    if (tag) parts.push(`#${tag}`);
                });
            }

            // Accounts (IMPORTANT: multiple accounts should be OR, not AND)
            const froms = splitList($("fromAccounts").value);
            const tos = splitList($("toAccounts").value);
            const mentions = splitList($("mentions").value);

            const fromClause = orGroup(froms, a => `from:${a.replace(/^@/, "")}`);
            if (fromClause) parts.push(fromClause);

            const toClause = orGroup(tos, a => `to:${a.replace(/^@/, "")}`);
            if (toClause) parts.push(toClause);

            const mentionClause = orGroup(mentions, a => `@${a.replace(/^@/, "")}`);
            if (mentionClause) parts.push(mentionClause);

            // Dates
            const since = $("since").value.trim();
            if (since) parts.push(`since:${since}`);

            const until = $("until").value.trim();
            if (until) parts.push(`until:${until}`);

            // Language
            const lang = $("lang").value.trim();
            if (lang) parts.push(`lang:${lang}`);

            // Filters: Replies
            if ($("replyOnly").checked) parts.push(`filter:replies`);

            // Filters: Links
            if ($("linkOnly").checked) parts.push(`filter:links`);

            // Engagement
            const minReplies = safeInt($("minReplies").value);
            if (minReplies !== null) parts.push(`min_replies:${minReplies}`);

            const minLikes = safeInt($("minLikes").value);
            if (minLikes !== null) parts.push(`min_faves:${minLikes}`);

            const minReposts = safeInt($("minReposts").value);
            if (minReposts !== null) parts.push(`min_retweets:${minReposts}`);

            // NOTE: Do NOT wrap the whole query in parentheses.
            return parts.filter(Boolean).join(" ").trim();
        }

        function buildUrl(rawQuery) {
            const base = "https://x.com/search";
            const f = $("tab").value || "top";
            if (!rawQuery) return `${base}?src=typed_query&f=${f}`;
            return `${base}?q=${encodeURIComponent(rawQuery)}&src=typed_query&f=${f}`;
        }

        function refresh() {
            const raw = buildQuery();
            $("query").value = raw;
            $("url").value = buildUrl(raw);
        }

        const inputIds = [
            "allWords", "exactPhrase", "anyWords", "noneWords", "hashtags",
            "fromAccounts", "toAccounts", "mentions", "since", "until", "lang",
            "minReplies", "minLikes", "minReposts"
        ];

        inputIds.forEach(id => $(id).addEventListener("input", refresh));

        // Select should use change for reliability
        $("tab").addEventListener("change", refresh);

        // Radios need change listeners
        ["replyInclude", "replyOnly", "linkInclude", "linkOnly"].forEach(id => {
            $(id).addEventListener("change", refresh);
        });

        $("copyUrl").addEventListener("click", async () => {
            await navigator.clipboard.writeText($("url").value);
            $("copyUrl").textContent = "Copied!";
            setTimeout(() => $("copyUrl").textContent = "Copy URL", 900);
        });

        $("copyQuery").addEventListener("click", async () => {
            await navigator.clipboard.writeText($("query").value);
            $("copyQuery").textContent = "Copied!";
            setTimeout(() => $("copyQuery").textContent = "Copy query", 900);
        });

        $("openX").addEventListener("click", () => {
            const u = $("url").value;
            if (u) window.open(u, "_blank", "noopener,noreferrer");
        });

        $("reset").addEventListener("click", () => {
            // Clear only text/number inputs (donâ€™t mess with radio values)
            document.querySelectorAll('input[type="text"], input[type="number"], input:not([type])').forEach(i => i.value = "");
            $("tab").value = "top";

            // Reset radios to defaults
            $("replyInclude").checked = true;
            $("linkInclude").checked = true;

            refresh();
        });

        refresh();
    </script>
</body>

</html>